
# for each FED which shares an FRL with another FED,
# this maps to the peer FED. If a FED does not appear
# in this dict, it does not share an FRL with another FED
#
# note that this dict contains the mapping in both directions
# (i.e. if A maps to B, B also maps to A)
#
# this was generated using the script makeFEDtoFRLMapping.py
# from the spreadsheets on
# https://twiki.cern.ch/twiki/bin/view/CMS/DAQ-CI-subdet-DAQ-Mapping

fedToPeerFedMapping = {
    74: 118,
    75: 119,
    76: 120,
    77: 121,
    78: 122,
    79: 123,
    80: 124,
    81: 125,
    82: 126,
    83: 127,
    84: 128,
    85: 129,
    86: 87,
    87: 86,
    88: 89,
    89: 88,
    90: 91,
    91: 90,
    92: 93,
    93: 92,
    94: 95,
    95: 94,
    96: 97,
    97: 96,
    98: 99,
    99: 98,
    100: 101,
    101: 100,
    102: 103,
    103: 102,
    104: 105,
    105: 104,
    106: 107,
    107: 106,
    108: 109,
    109: 108,
    110: 111,
    111: 110,
    112: 113,
    113: 112,
    114: 115,
    115: 114,
    116: 117,
    117: 116,
    118: 74,
    119: 75,
    120: 76,
    121: 77,
    122: 78,
    123: 79,
    124: 80,
    125: 81,
    126: 82,
    127: 83,
    128: 84,
    129: 85,
    164: 165,
    165: 164,
    166: 204,
    167: 205,
    168: 206,
    169: 207,
    170: 208,
    171: 209,
    172: 210,
    173: 211,
    174: 203,
    175: 176,
    176: 175,
    177: 178,
    178: 177,
    179: 180,
    180: 179,
    181: 182,
    182: 181,
    183: 184,
    184: 183,
    185: 186,
    186: 185,
    187: 188,
    188: 187,
    189: 190,
    190: 189,
    191: 192,
    192: 191,
    193: 194,
    194: 193,
    195: 196,
    196: 195,
    197: 198,
    198: 197,
    199: 200,
    200: 199,
    201: 202,
    202: 201,
    203: 174,
    204: 166,
    205: 167,
    206: 168,
    207: 169,
    208: 170,
    209: 171,
    210: 172,
    211: 173,
    212: 236,
    213: 237,
    214: 238,
    215: 239,
    216: 240,
    217: 241,
    218: 242,
    219: 243,
    220: 244,
    221: 245,
    222: 246,
    223: 247,
    224: 248,
    225: 249,
    226: 250,
    227: 251,
    228: 252,
    229: 253,
    230: 254,
    231: 255,
    232: 256,
    233: 257,
    234: 258,
    235: 259,
    236: 212,
    237: 213,
    238: 214,
    239: 215,
    240: 216,
    241: 217,
    242: 218,
    243: 219,
    244: 220,
    245: 221,
    246: 222,
    247: 223,
    248: 224,
    249: 225,
    250: 226,
    251: 227,
    252: 228,
    253: 229,
    254: 230,
    255: 231,
    256: 232,
    257: 233,
    258: 234,
    259: 235,
    260: 292,
    261: 293,
    262: 294,
    263: 295,
    264: 296,
    265: 297,
    266: 298,
    267: 299,
    268: 300,
    269: 301,
    270: 302,
    271: 303,
    272: 304,
    273: 305,
    274: 306,
    275: 307,
    276: 308,
    277: 309,
    278: 310,
    279: 311,
    280: 312,
    281: 313,
    282: 314,
    283: 315,
    284: 318,
    285: 319,
    286: 320,
    287: 321,
    288: 322,
    289: 323,
    290: 324,
    291: 325,
    292: 260,
    293: 261,
    294: 262,
    295: 263,
    296: 264,
    297: 265,
    298: 266,
    299: 267,
    300: 268,
    301: 269,
    302: 270,
    303: 271,
    304: 272,
    305: 273,
    306: 274,
    307: 275,
    308: 276,
    309: 277,
    310: 278,
    311: 279,
    312: 280,
    313: 281,
    314: 282,
    315: 283,
    316: 317,
    317: 316,
    318: 284,
    319: 285,
    320: 286,
    321: 287,
    322: 288,
    323: 289,
    324: 290,
    325: 291,
    326: 355,
    327: 328,
    328: 327,
    329: 330,
    330: 329,
    331: 332,
    332: 331,
    333: 334,
    334: 333,
    335: 336,
    336: 335,
    337: 338,
    338: 337,
    339: 340,
    340: 339,
    341: 342,
    342: 341,
    343: 344,
    344: 343,
    345: 346,
    346: 345,
    347: 348,
    348: 347,
    349: 350,
    350: 349,
    351: 352,
    352: 351,
    353: 354,
    354: 353,
    355: 326,
    356: 444,
    357: 445,
    358: 446,
    359: 447,
    360: 448,
    361: 449,
    362: 450,
    363: 451,
    364: 452,
    365: 453,
    366: 454,
    367: 455,
    368: 413,
    369: 414,
    370: 415,
    371: 456,
    372: 457,
    373: 427,
    374: 428,
    375: 429,
    376: 464,
    377: 465,
    378: 466,
    379: 467,
    380: 468,
    381: 469,
    382: 470,
    383: 471,
    384: 472,
    385: 473,
    386: 430,
    387: 431,
    388: 432,
    389: 433,
    390: 434,
    391: 435,
    392: 436,
    393: 437,
    394: 438,
    395: 439,
    396: 440,
    397: 441,
    398: 442,
    399: 443,
    402: 485,
    403: 486,
    404: 487,
    405: 488,
    406: 489,
    407: 458,
    408: 459,
    409: 460,
    410: 461,
    411: 462,
    412: 463,
    413: 368,
    414: 369,
    415: 370,
    416: 474,
    417: 475,
    418: 476,
    419: 477,
    420: 478,
    421: 479,
    422: 480,
    423: 481,
    424: 482,
    425: 483,
    426: 484,
    427: 373,
    428: 374,
    429: 375,
    430: 386,
    431: 387,
    432: 388,
    433: 389,
    434: 390,
    435: 391,
    436: 392,
    437: 393,
    438: 394,
    439: 395,
    440: 396,
    441: 397,
    442: 398,
    443: 399,
    444: 356,
    445: 357,
    446: 358,
    447: 359,
    448: 360,
    449: 361,
    450: 362,
    451: 363,
    452: 364,
    453: 365,
    454: 366,
    455: 367,
    456: 371,
    457: 372,
    458: 407,
    459: 408,
    460: 409,
    461: 410,
    462: 411,
    463: 412,
    464: 376,
    465: 377,
    466: 378,
    467: 379,
    468: 380,
    469: 381,
    470: 382,
    471: 383,
    472: 384,
    473: 385,
    474: 416,
    475: 417,
    476: 418,
    477: 419,
    478: 420,
    479: 421,
    480: 422,
    481: 423,
    482: 424,
    483: 425,
    484: 426,
    485: 402,
    486: 403,
    487: 404,
    488: 405,
    489: 406
    }

#----------------------------------------------------------------------

def makeFRLtuples(fedList):
    """ returns a list of tuples with the given feds, either
    alone (all subsystems but the strip tracker) or paired
    if both FEDs of an FRL are given (i.e. if only one FED
    of an FRL with two FEDs is given as input, there will
    only be the given FED in the tuple).

    Useful to plot e.g. the per FRL rate instead of the per FED rate
    """

    retval = []
    fedsProcessed = set()

    import utils

    for fed in fedList:

        # avoid plotting a pair of
        # FEDs twice
        if fed in fedsProcessed:
            continue

        fedsProcessed.add(fed)

        peerFED =  fedToPeerFedMapping.get(fed,None)

        # make sure that the peer FED normally is part of data taking
        if peerFED != None and not peerFED in utils.trackerFeds:
            peerFED = None

        if peerFED == None:
            # this FED has no peer
            retval.append((fed,))
        else:
            fedsProcessed.add(peerFED)

            # this FED shares an FRL with another FED
            thisFeds = sorted([fed, peerFED])
            retval.append(tuple(thisFeds))

    # end of loop of all given feds
    return retval
    

    

#----------------------------------------------------------------------
